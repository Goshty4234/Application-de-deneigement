<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Intervention Déneigement - {{ client.nom }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background-image: url('/Images/Image tracteur nuit 1.jpg');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-repeat: no-repeat;
        }
        
        .overlay {
            background: rgba(0, 0, 0, 0.4);
            min-height: 100vh;
        }
        
        .content-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <div class="overlay">
    <div class="container mx-auto px-4 py-8 max-w-2xl">
        <!-- Carte principale -->
        <div class="content-card rounded-lg shadow-lg p-6 mb-6">
            <h1 class="text-3xl font-bold text-gray-800 mb-2">Bonjour {{ client.nom }}!</h1>
            <p class="text-gray-600 mb-6">Informations sur votre intervention de déneigement</p>

            <!-- Statut -->
            <div class="mb-6">
                <h2 class="text-sm font-semibold text-gray-500 uppercase mb-2">Statut</h2>
                <div class="inline-block">
                    {% if client.status == 'planifié' %}
                        <span class="px-4 py-2 bg-blue-100 text-blue-800 text-lg font-semibold rounded-full">
                            Planifié
                        </span>
                    {% elif client.status == 'en_route' %}
                        <span class="px-4 py-2 bg-yellow-100 text-yellow-800 text-lg font-semibold rounded-full">
                            En route
                        </span>
                    {% elif client.status == 'commence' %}
                        <span class="px-4 py-2 bg-orange-100 text-orange-800 text-lg font-semibold rounded-full">
                            En cours
                        </span>
                    {% elif client.status == 'termine' %}
                        <span class="px-4 py-2 bg-green-100 text-green-800 text-lg font-semibold rounded-full">
                            Terminé
                        </span>
                    {% endif %}
                </div>
            </div>

            <!-- Informations -->
            <div class="space-y-4">
                <div>
                    <h2 class="text-sm font-semibold text-gray-500 uppercase mb-1">Adresse</h2>
                    <p class="text-lg text-gray-800">{{ client.adresse }}</p>
                </div>

                <div>
                    <h2 class="text-sm font-semibold text-gray-500 uppercase mb-1">Date</h2>
                    <p class="text-lg text-gray-800" id="dateFormatted">{{ client.date_intervention }}</p>
                </div>

                <div>
                    <h2 class="text-sm font-semibold text-gray-500 uppercase mb-1">Horaire prévu</h2>
                    <p class="text-lg text-gray-800" id="heureFormatted">
                        {{ client.heure_debut }}
                        {% if client.heure_fin %}
                            - {{ client.heure_fin }}
                        {% endif %}
                    </p>
                </div>
            </div>
        </div>

        <!-- Message selon statut -->
        <div class="content-card rounded-lg shadow-md p-6">
            {% if client.status == 'planifié' %}
                <div class="bg-blue-50 border-l-4 border-blue-500 p-4">
                    <p class="text-blue-800">
                        <strong>Intervention planifiée</strong><br>
                        Votre intervention est prévue. Vous recevrez une notification lorsque le déneigeur sera en route.
                    </p>
                </div>
            {% elif client.status == 'en_route' %}
                <div class="bg-yellow-50 border-l-4 border-yellow-500 p-4">
                    <p class="text-yellow-800">
                        <strong>Le déneigeur est en route!</strong><br>
                        Merci de libérer votre entrée et de retirer votre voiture si nécessaire.
                    </p>
                </div>
            {% elif client.status == 'commence' %}
                <div class="bg-orange-50 border-l-4 border-orange-500 p-4">
                    <p class="text-orange-800">
                        <strong>Intervention en cours</strong><br>
                        Le déneigeur est maintenant sur place et effectue le déneigement.
                    </p>
                </div>
            {% elif client.status == 'termine' %}
                <div class="bg-green-50 border-l-4 border-green-500 p-4">
                    <p class="text-green-800">
                        <strong>Intervention terminée</strong><br>
                        Votre entrée est maintenant déneigée. Vous pouvez remettre votre voiture.
                    </p>
                </div>
            {% endif %}
        </div>

        <!-- Note -->
        <div class="mt-6 text-center text-sm text-gray-500">
            <p>Cette page se met à jour automatiquement. Vous recevrez également des notifications par SMS et email.</p>
        </div>
    </div>

    <script>
        // Formater la date
        function formatDate(dateStr) {
            if (!dateStr) return '';
            const date = new Date(dateStr + 'T00:00:00');
            return date.toLocaleDateString('fr-FR', { 
                weekday: 'long', 
                day: 'numeric', 
                month: 'long',
                year: 'numeric'
            });
        }

        // Formater l'heure
        function formatTime(timeStr) {
            if (!timeStr) return '';
            const [h, m] = timeStr.split(':');
            return `${parseInt(h)}h${m || '00'}`;
        }

        // Appliquer le formatage
        const dateEl = document.getElementById('dateFormatted');
        if (dateEl) {
            dateEl.textContent = formatDate(dateEl.textContent.trim());
        }

        const heureEl = document.getElementById('heureFormatted');
        if (heureEl) {
            const text = heureEl.textContent.trim();
            const parts = text.split(' - ');
            if (parts.length === 2) {
                heureEl.textContent = `${formatTime(parts[0])} - ${formatTime(parts[1])}`;
            } else {
                heureEl.textContent = formatTime(text);
            }
        }

        // Auto-refresh toutes les 30 secondes
        setInterval(() => {
            location.reload();
        }, 30000);
    </script>
    </div>
    </div>
</body>
</html>

